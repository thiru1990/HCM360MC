ç8
3D:\Solutions\Services\HCM360\AddClaims\AddClaims.cs
	namespace		 	
	AddClaims		
 
{

 
public 

static 
class 
	AddClaims !
{ 
public 
static 
string 
SQLConnectionString 0
=1 2
Environment3 >
.> ?"
GetEnvironmentVariable? U
(U V
$strV k
)k l
;l m
[ 	
FunctionName	 
( 
$str !
)! "
]" #
public 
static 
void 
Run 
( 
[  
ServiceBusTrigger  1
(1 2
$str2 ?
,? @
$strA U
,U V

ConnectionW a
=b c
$strd ~
)~ 
]	 Ä
string
Å á
mySbMsg
à è
,
è ê
ILogger
ë ò
log
ô ú
)
ú ù
{ 	
log 
. 
LogInformation 
( 
$" !D
8C# ServiceBus topic trigger function processed message: ! Y
{Y Z
mySbMsgZ a
}a b
"b c
)c d
;d e
var 
claim 
= 
JsonConvert #
.# $
DeserializeObject$ 5
<5 6
Claim6 ;
>; <
(< =
mySbMsg= D
)D E
;E F
log 
. 
LogInformation 
( 
$" !D
8C# ServiceBus topic trigger function processed message: ! Y
{Y Z
claimZ _
}_ `
"` a
)a b
;b c
if 
( 
claim 
is 
Claim 
clm "
)" #
{ 
log 
. 
LogInformation "
(" #
$"# %D
8C# ServiceBus topic trigger function processed message: % ]
{] ^
clm^ a
}a b
"b c
)c d
;d e
var 
claimTypeID 
=  !
GetClaimType" .
(. /
log/ 2
:2 3
log4 7
,7 8
	claimType9 B
:B C
clmD G
.G H
	ClaimTypeH Q
)Q R
;R S
if 
( 
claimTypeID 
>  !
$num" #
)# $
{ 
using 
( 
SqlConnection (
con) ,
=- .
new/ 2
SqlConnection3 @
(@ A
SQLConnectionStringA T
)T U
)U V
{   
con!! 
.!! 
Open!!  
(!!  !
)!!! "
;!!" #
var"" 
query"" !
=""" #
$str""$ B
+""C D
claimTypeID""E P
+""Q R
$str""S V
+""W X
clm""Y \
.""\ ]
ClaimAmount""] h
+""i j
$str""k o
+""p q
clm""r u
.""u v
	ClaimDate""v 
.	"" Ä
ToString
""Ä à
(
""à â
)
""â ä
+
""ã å
$str
""ç í
+
""ì î
clm
""ï ò
.
""ò ô
Remarks
""ô †
+
""° ¢
$str
""£ ß
+
""® ©
clm
""™ ≠
.
""≠ Æ
MemberID
""Æ ∂
+
""∑ ∏
$str
""π º
;
""º Ω
log## 
.## 
LogInformation## *
(##* +
$"##+ -
insert query : ##- <
{##< =
query##= B
}##B C
"##C D
)##D E
;##E F
using$$ 
($$ 

SqlCommand$$ )
cmd$$* -
=$$. /
new$$0 3

SqlCommand$$4 >
($$> ?
query$$? D
,$$D E
con$$F I
)$$I J
)$$J K
{%% 
var&& 
rows&&  $
=&&% &
cmd&&' *
.&&* +
ExecuteNonQuery&&+ :
(&&: ;
)&&; <
;&&< =
log'' 
.''  
LogInformation''  .
(''. /
$"''/ 1
{''1 2
rows''2 6
}''6 7
 rows were updated''7 I
"''I J
)''J K
;''K L
}(( 
})) 
}** 
}++ 
int.. 
GetClaimType.. 
(.. 
string.. #
	claimType..$ -
,..- .
ILogger../ 6
log..7 :
)..: ;
{// 
int11 
claimTypeID11 
=11  !
default11" )
;11) *
using22 
(22 
SqlConnection22 $
con22% (
=22) *
new22+ .
SqlConnection22/ <
(22< =
SQLConnectionString22= P
)22P Q
)22Q R
{33 
con44 
.44 
Open44 
(44 
)44 
;44 
var55 
query55 
=55 
$str55  Z
+55[ \
	claimType55] f
+55g h
$str55i l
;55l m
log66 
.66 
LogInformation66 &
(66& '
$"66' )
claim query : 66) 7
{667 8
query668 =
}66= >
"66> ?
)66? @
;66@ A
using77 
(77 

SqlCommand77 %
cmd77& )
=77* +
new77, /

SqlCommand770 :
(77: ;
query77; @
,77@ A
con77B E
)77E F
)77F G
{88 
var99 
rows99  
=99! "
cmd99# &
.99& '
ExecuteScalar99' 4
(994 5
)995 6
;996 7
log:: 
.:: 
LogInformation:: *
(::* +
$"::+ -
Claim Type ID: ::- <
{::< =
rows::= A
}::A B
"::B C
)::C D
;::D E
claimTypeID;; #
=;;$ %
Convert;;& -
.;;- .
ToInt32;;. 5
(;;5 6
rows;;6 :
);;: ;
;;;; <
}<< 
}== 
return>> 
claimTypeID>> "
;>>" #
}?? 
}@@ 	
}AA 
publicBB 

classBB 
ClaimBB 
{CC 
publicDD 
stringDD 
	ClaimTypeDD 
{DD  !
getDD" %
;DD% &
setDD' *
;DD* +
}DD, -
publicFF 
decimalFF 
ClaimAmountFF "
{FF# $
getFF% (
;FF( )
setFF* -
;FF- .
}FF/ 0
publicHH 
DateTimeHH 
	ClaimDateHH !
{HH" #
getHH$ '
;HH' (
setHH) ,
;HH, -
}HH. /
publicJJ 
stringJJ 
RemarksJJ 
{JJ 
getJJ  #
;JJ# $
setJJ% (
;JJ( )
}JJ* +
publicLL 
intLL 
MemberIDLL 
{LL 
getLL !
;LL! "
setLL# &
;LL& '
}LL( )
}MM 
}NN 